// script variables

var include_num = 1;
var bold = 0;
var od = d;
var switchme = 0;
var r = new Array();
var co = 0;

// variable definition for the cookie
var cookies = document.cookie;
var p = cookies.indexOf("d=");

// looks for cookie defined above, extracts it and converts it for use in results page
// apparently unescape isn't recommended anymore, look for viable alternative
if (p != -1) {
	var st = p + 2;
	var en = cookies.indexOf(";", st);
	if (en == -1) {
		en = cookies.length;
	}
	var d = cookies.substring(st, en);
	d = unescape(d);
}
// puts search results with potentially exploitative characters in quotes
if (d.charAt(0) == '"' && d.charAt(d.length - 1) == '"') {
	switchme = 1;
}


if (switchme == 0) {
	var woin = new Array();
	var w = d.split(" ");
	for (var a = 0; a < w.length; a++) {
		woin[a] = 0;
		if (w[a].charAt(0) == '-') {
			woin[a] = 1;
		}
	}
	for (var a = 0; a < w.length; a++) {
		w[a] = w[a].replace(/^\-|^\+/gi, "");
	}
	a = 0;
	for (var c = 0; c < s.length; c++) {
		pa = 0;
		nh = 0;
		for (var i = 0; i < woin.length; i++) {
			if (woin[i] == 0) {
				nh++;
				var pat = new RegExp(w[i], "i");
				var rn = s[c].search(pat);
				if (rn >= 0) {
					pa++;
				} else {
					pa = 0;
				}
			}
			if (woin[i] == 1) {
				var pat = new RegExp(w[i], "i");
				var rn = s[c].search(pat);
				if (rn >= 0) {
					pa = 0;
				}
			}
		}
		if (pa == nh) {
			r[a] = s[c];
			a++;
		}
	}
	co = a;
}

if (switchme == 1) {
	d = d.replace(/"/gi, "");
	var a = 0;
	var pat = new RegExp(d, "i");
	for (var c = 0; c < s.length; c++) {
		var rn = s[c].search(pat);
		if (rn >= 0) {
			r[a] = s[c];
			a++;
		}
	}
	co = a;
}

// function for moving the cookie to results tab
function return_query() {
	document.howto_Form.d.value = od;
}

// define the number of results for displaying to end user 
function resultsnumber() {
	document.write(co);
}

// If query returns no results, display this message. Otherwise, display results
function out_jse() {
	if (co == 0) {
		document.write('Think there should be results for that?<p> Please let us know! We will add it to our database.');
		return;
	}
	for (var a = 0; a < r.length; a++) {
		var os = r[a].split("^");
		if (bold == 1 && switchme == 1) {
			var br = "<b>" + d + "</b>";
			os[2] = os[2].replace(pat, br);
		}
		if (include_num == 1) {
			document.write(a + 1, '. <a href="', os[1], '">', os[0], '</a><br>', os[2], '<p>');
		} else {
			document.write('<a href="', os[1], '">', os[0], '</a><br>', os[2], '<p>');
		}
	}

}
